<link href="/static/css/jquery.oembed.css" media="all" rel="stylesheet" type="text/css" />
<div class='row'>
  <div class='col-md-12'>
    <div class='page-header'>
      <h2>
        <%= @event_session.name %>
        <small>
          <%= link_to event_path(@event_session.event), :style => 'text-decoration: none;' do %>
            <span class='label label-success'><%= @event_session.event.descriptive_name %></span>
          <% end %>
        </small>
      </h2>
    </div>
  </div>
</div>

<div class='row'>
  <div class='col-md-4'>
    <div class='row'>
      <%= render :partial => 'shared/pp_avatar_social', :locals => { :user => @event_session.user } %>
    </div>
  </div>
  <div class='col-md-8'>
    <div class='row'>
      <div class='col-md-6'>
        <% unless @event_session.presentation_url.blank? %>
        <p>
          <%= link_to "", safe_url(@event_session.presentation_url), :class => 'embed', :target => '_blank' %>
        </p>
        <% end %>
      </div>
      <div class='col-md-6'>
        <% unless @event_session.video_url.blank? %>
        <p>
          <%= link_to "", safe_url(@event_session.video_url), :class => 'embed', :target => '_blank' %>
        </p>
        <% end %>
      </div>
    </div>
    <h3>
      Abstract
      <small>
        <% if can? :edit, @event_session %>
          <%= link_to edit_event_session_path(@event_session), :class => 'btn btn-primary btn-sm' do %>
            <%= fa_icon(:edit) %> Edit Description
          <% end %>
        <% end %>
      </small>
    </h3>
    <blockquote>
      <%= safe_markdown_html(@event_session.description.to_s) %>
    </blockquote>

    <h3>Speaker</h3>
    <p style='font-size: 110%'>
      <strong>
        <%= link_to @event_session.user.name, public_profile_path(@event_session.user), :style => 'text-decoration: none;' %>
      </strong>
    </p>
    <p>
      <%= safe_markdown_html(@event_session.user.about_me.to_s) %>
    </p>

    <h3>Timing</h3>
    <p>
      Starts at <strong><%= @event_session.start_time.strftime("%A %B %d %Y, %I:%M %p") %></strong>. The sessions runs for <strong><%= distance_of_time_in_words(@event_session.end_time, @event_session.start_time) %></strong>.
    </p>
    <h3>Resources</h3>
    <% unless @event_session.presentation_url.blank? %>
    <p>
      <%= link_to "", safe_url(@event_session.presentation_url), :class => 'fa-file-powerpoint-o fa fa-5x', :target => '_blank' %>
    <% end %>
    &nbsp;
    <% unless @event_session.video_url.blank? %>
        <%= link_to "", safe_url(@event_session.video_url), :class => 'fa-file-video-o fa fa-5x', :target => '_blank' %>
    </p>
    <% end %>
    <div class="reaction">
      <%= link_to like_event_session_path(@event_session), :id=>"like", :method=>"post", data: { toggle: 'tooltip', placement: 'top', title: 'Sign in to like this session'}, remote: true do %>
        <%= fa_icon "thumbs-up" %><span id="like-size"><%= @event_session.get_likes.size %></span>
      <% end %>
      <%= link_to dislike_event_session_path(@event_session), :id=>"dislike", :method=>"post", data: { toggle: 'tooltip', placement: 'top', title: 'Sign in to dislike this session'}, remote: true do %>
        <%= fa_icon "thumbs-down" %><span id="dislike-size"><%= @event_session.get_dislikes.size %></span>
      <% end %>
      <span class="reaction-inactive">
        <%= fa_icon "comments" %> <%= @event_session_comments.length %>
      </span>
    </div>
    <% if user_signed_in? %>
      <%= form_for @event_session_comment do |f| %>
        <div class="comment flex-container">
          <div class="add-comment-item">
            <%= link_to(image_tag(current_user.avatar.url, :class => 'img', :size => '40x40'), public_profile_path(current_user)) %>
          </div>
          <div class="add-comment-item new-comment-input" >
            <%= f.text_field :comment_body, :class => 'form-control', placeholder: "Add a comment..." %>
            <%= f.hidden_field :user_id, value: current_user.id %>
            <%= f.hidden_field :event_session_id, value: @event_session.id %>
          </div>
          <div>
            <%= f.submit 'Add Comment', :class => 'btn btn-sm btn-primary' %>
          </div>

        </div>
      <% end %>
    <% else %>
    <div class="text-center text-muted event-session-signin-warning">
      You need to be signed in to add comments.
    </div>
    <% end %>
    <div class="comment">
      <% @event_session_comments.each do |comment| %>
        <% user = User.find(comment.user_id) %>
        <div class="media" id="comment-<%=comment.id%>">
          <div class="media-left media-top">
            <%= link_to(image_tag(user.avatar.url, :class => 'img', :size => '50x50'), public_profile_path(user)) %>
          </div>
          <div class="media-body">
            <div class="media-heading"><span class="h4"><%= link_to public_profile_path(user) do %> <%= user.name %> <% end %></span> <span class="text-muted"> <%= time_ago_in_words(comment.created_at) %> </span> </div>
            <div class="h5 comment-body"> <%= comment.comment_body%> </div>
            <div>
              <% if user_signed_in? && user==current_user  %>
                <%= link_to 'Edit', edit_event_session_comment_path(comment), class: "text-muted underline event-session-comment-option", remote: true %> <%= link_to 'Delete', event_session_comment_path(comment), method: "delete", data: { confirm: "Are you sure you want to delete the comment?" }, class: "text-muted underline event-session-comment-option" %>
              <% end %>
            </div>
          </div>
        </div>
        <hr>    
      <% end %>
    </div>
  </div>
</div>
<script src="/static/javascripts/jquery.oembed.js"></script>
<script>
$(window).on("load", function(){
  $('#like').addClass("reaction-inactive");
  <% if user_signed_in? %>
    <% if current_user.voted_up_on? @event_session %>
      $('#like').removeClass();
      $('#like').addClass("reaction-active");
    <% end %>
  <% end %>
  $('#dislike').addClass("reaction-inactive");
  <% if user_signed_in? %>
    <% if current_user.voted_down_on? @event_session %>
      $('#dislike').removeClass();
      $('#dislike').addClass("reaction-active");
    <% end %>
  <% end %>
});

$("#show-comments").click(function() {
  $("#show-comments").toggleClass("reaction-inactive reaction-active");
});
<% unless user_signed_in? %>
  $(document).ready(function(){
    $('[data-toggle="tooltip"]').tooltip(); 
  });
<% end %>
$(".reaction-inactive").hover(function(){
  $(this).css("color","#11536E");
  }, function(){
  $(this).css("color","#6d6d6d");
});
$(function(){
  $("a.embed").oembed();
});
</script>
